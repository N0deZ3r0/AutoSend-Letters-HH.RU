console.log('=== HH –ê–≤—Ç–æ-–æ—Ç–∫–ª–∏–∫ ===');

// –ù–∞—Å—Ç—Ä–æ–π–∫–∏
let coverLetter = `–î–æ–±—Ä—ã–π –¥–µ–Ω—å!

–ó–∞–∏–Ω—Ç–µ—Ä–µ—Å–æ–≤–∞–ª–∞ –≤–∞—à–∞ –≤–∞–∫–∞–Ω—Å–∏—è. –ú–æ–π –æ–ø—ã—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º. –ì–æ—Ç–æ–≤(–∞) –∫ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏—é.

–° —É–≤–∞–∂–µ–Ω–∏–µ–º,
[–í–∞—à–µ –ò–º—è]`;

let isRunning = false;
let processedVacancies = new Set();
let stats = {
    success: 0,
    failed: 0,
    skipped: 0,
    total: 0
};

// –°–æ–∑–¥–∞–µ–º –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
function createPanel() {
    // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—É—é –ø–∞–Ω–µ–ª—å –µ—Å–ª–∏ –µ—Å—Ç—å
    const oldPanel = document.getElementById('hh-auto-panel');
    if (oldPanel) oldPanel.remove();
    
    const panel = document.createElement('div');
    panel.id = 'hh-auto-panel';
    panel.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 10000;
        background: white;
        border: 2px solid #4CAF50;
        border-radius: 8px;
        padding: 15px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        min-width: 280px;
        font-family: Arial, sans-serif;
        max-height: 90vh;
        overflow-y: auto;
    `;
    
    panel.innerHTML = `
        <div style="margin-bottom: 15px;">
            <h3 style="margin: 0 0 10px 0; color: #2196F3; font-size: 16px;">ü§ñ HH –ê–≤—Ç–æ-–æ—Ç–∫–ª–∏–∫ </h3>
            <div id="hh-status" style="background: #f0f8ff; padding: 8px; border-radius: 4px; font-size: 13px; min-height: 40px; margin-bottom: 10px; white-space: pre-line;">
                –ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <div style="font-size: 12px; color: #666;">
                    üîç –ù–∞–π–¥–µ–Ω–æ: <span id="hh-count" style="font-weight: bold;">0</span>
                </div>
                <div id="hh-stats" style="font-size: 11px; color: #666; background: #f5f5f5; padding: 4px 8px; border-radius: 4px;">
                    ‚úÖ0 ‚ùå0 ‚è≠Ô∏è0
                </div>
            </div>
        </div>
        
        <div style="margin-bottom: 10px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                <div style="font-weight: bold; font-size: 13px;">üìù –°–æ–ø—Ä–æ–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ–µ –ø–∏—Å—å–º–æ:</div>
                <button id="hh-save" style="background: #2196F3; color: white; border: none; border-radius: 4px; padding: 4px 8px; font-size: 11px; cursor: pointer;">
                    üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                </button>
            </div>
            <textarea id="hh-letter" style="width: 100%; height: 90px; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 13px; resize: vertical;">${coverLetter}</textarea>
            <div style="font-size: 11px; color: #666; margin-top: 3px; display: flex; justify-content: space-between;">
                <span>* –£–∫–∞–∂–∏—Ç–µ —Å–≤–æ—ë –Ω–∞—Å—Ç–æ—è—â–µ–µ –∏–º—è</span>
                <span id="hh-char-count">${coverLetter.length}/2000</span>
            </div>
        </div>
        
        <div style="display: flex; flex-direction: column; gap: 8px; margin-bottom: 10px;">
            <button id="hh-start" style="padding: 12px; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 14px;">
                ‚ñ∂Ô∏è –ù–ê–ß–ê–¢–¨ –ê–í–¢–û-–û–¢–ö–õ–ò–ö
            </button>
            <button id="hh-test" style="padding: 10px; background: #9C27B0; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 13px;">
                üß™ –¢–µ—Å—Ç –Ω–∞ 1 –≤–∞–∫–∞–Ω—Å–∏—é
            </button>
            <button id="hh-stop" style="padding: 12px; background: #f44336; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 14px; display: none;">
                ‚èπÔ∏è –û–°–¢–ê–ù–û–í–ò–¢–¨
            </button>
        </div>
        
        <div style="margin-top: 15px; font-size: 11px; color: #666; text-align: center; border-top: 1px solid #eee; padding-top: 10px;">
            <div style="margin-bottom: 8px;">
                <button id="hh-clear" style="background: #607D8B; color: white; border: none; border-radius: 4px; padding: 6px 12px; font-size: 11px; cursor: pointer; margin-right: 8px;">
                    üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é
                </button>
                <button id="hh-analyze" style="background: #FF9800; color: white; border: none; border-radius: 4px; padding: 6px 12px; font-size: 11px; cursor: pointer;">
                    üìä –ê–Ω–∞–ª–∏–∑
                </button>
            </div>
            <div> by alex </div>
        </div>
    `;
    
    document.body.appendChild(panel);
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
    document.getElementById('hh-start').addEventListener('click', startProcess);
    document.getElementById('hh-test').addEventListener('click', testProcess);
    document.getElementById('hh-stop').addEventListener('click', stopProcess);
    document.getElementById('hh-save').addEventListener('click', saveLetter);
    document.getElementById('hh-clear').addEventListener('click', clearHistory);
    document.getElementById('hh-analyze').addEventListener('click', analyzePage);
    document.getElementById('hh-letter').addEventListener('input', updateCharCount);
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–µ –ø–∏—Å—å–º–æ
    const savedLetter = localStorage.getItem('hh_auto_letter');
    if (savedLetter) {
        document.getElementById('hh-letter').value = savedLetter;
        coverLetter = savedLetter;
        updateCharCount();
    }
}

// –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å
function updateStatus(msg) {
    const statusEl = document.getElementById('hh-status');
    if (statusEl) {
        statusEl.textContent = msg;
        console.log('–°—Ç–∞—Ç—É—Å:', msg);
    }
}

// –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
function updateStats() {
    const statsEl = document.getElementById('hh-stats');
    if (statsEl) {
        statsEl.textContent = `‚úÖ${stats.success} ‚ùå${stats.failed} ‚è≠Ô∏è${stats.skipped}`;
    }
}

// –û–±–Ω–æ–≤–∏—Ç—å —Å—á–µ—Ç—á–∏–∫ —Å–∏–º–≤–æ–ª–æ–≤
function updateCharCount() {
    const textarea = document.getElementById('hh-letter');
    const counter = document.getElementById('hh-char-count');
    if (textarea && counter) {
        const length = textarea.value.length;
        counter.textContent = `${length}/2000`;
        counter.style.color = length > 2000 ? '#f44336' : '#666';
    }
}

// –û–±–Ω–æ–≤–∏—Ç—å —Å—á–µ—Ç—á–∏–∫ –≤–∞–∫–∞–Ω—Å–∏–π
function updateCounter() {
    const countEl = document.getElementById('hh-count');
    if (countEl) {
        const buttons = getAvailableButtons();
        countEl.textContent = buttons.length;
    }
}

// –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–∏—Å—å–º–æ
function saveLetter() {
    coverLetter = document.getElementById('hh-letter').value;
    localStorage.setItem('hh_auto_letter', coverLetter);
    
    const btn = document.getElementById('hh-save');
    const originalText = btn.textContent;
    btn.textContent = '‚úì –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!';
    btn.style.background = '#4CAF50';
    
    setTimeout(() => {
        btn.textContent = originalText;
        btn.style.background = '#2196F3';
    }, 1500);
    
    updateStatus('üíæ –ü–∏—Å—å–º–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ');
}

// –û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é
function clearHistory() {
    if (confirm('–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –≤–∞–∫–∞–Ω—Å–∏–π?')) {
        processedVacancies.clear();
        stats = { success: 0, failed: 0, skipped: 0, total: 0 };
        updateStats();
        updateStatus('üóëÔ∏è –ò—Å—Ç–æ—Ä–∏—è –æ—á–∏—â–µ–Ω–∞');
        
        // –£–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å—ã —Å –≤–∞–∫–∞–Ω—Å–∏–π
        document.querySelectorAll('.hh-processed').forEach(el => {
            el.classList.remove('hh-processed');
        });
    }
}

// –ê–Ω–∞–ª–∏–∑ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
function analyzePage() {
    const allButtons = document.querySelectorAll('[data-qa="vacancy-serp__vacancy_response"]');
    const responded = Array.from(allButtons).filter(btn => isAlreadyRespondedVacancy(btn));
    const available = allButtons.length - responded.length;
    
    const analysis = `üìä –ê–Ω–∞–ª–∏–∑ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:
‚Ä¢ –í—Å–µ–≥–æ –≤–∞–∫–∞–Ω—Å–∏–π: ${allButtons.length}
‚Ä¢ –£–∂–µ –æ—Ç–∫–ª–∏–∫–Ω—É–ª–∏—Å—å: ${responded.length}
‚Ä¢ –î–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è –æ—Ç–∫–ª–∏–∫–∞: ${available}
‚Ä¢ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ –≤ —Å–µ—Å—Å–∏–∏: ${stats.total}

üí° –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
‚úÖ –£—Å–ø–µ—à–Ω–æ: ${stats.success}
‚ùå –ù–µ—É–¥–∞—á–Ω–æ: ${stats.failed}
‚è≠Ô∏è –ü—Ä–æ–ø—É—â–µ–Ω–æ: ${stats.skipped}`;
    
    updateStatus(analysis);
}

// –ñ–¥–∞—Ç—å
function wait(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
}

// –ü–æ–ª—É—á–∏—Ç—å ID –≤–∞–∫–∞–Ω—Å–∏–∏
function getVacancyId(button) {
    const vacancyItem = button.closest('.vacancy-serp-item') || 
                       button.closest('.serp-item') ||
                       button.closest('[data-qa="vacancy-serp__vacancy"]');
    
    if (vacancyItem) {
        const link = vacancyItem.querySelector('a[href*="/vacancy/"]');
        if (link && link.href) {
            return link.href.split('?')[0];
        }
    }
    
    return button.href || `vacancy-${Date.now()}`;
}

// =========== –ü–†–û–í–ï–†–ö–ê –û–¢–ö–õ–ò–ö–û–í (–°–¢–ê–ë–ò–õ–¨–ù–ê–Ø) ===========
function isAlreadyRespondedVacancy(button) {
    // –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç—É —Ä–æ–¥–∏—Ç–µ–ª–µ–π –¥–ª—è –ø–æ–∏—Å–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
    const parent = button.closest('.vacancy-serp-item') || 
                   button.closest('.serp-item') ||
                   button.closest('[data-qa="vacancy-serp__vacancy"]');
    
    if (!parent) return false;
    
    // 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ data-qa –∞—Ç—Ä–∏–±—É—Ç—É (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π —Å–ø–æ—Å–æ–±)
    const respondedElement = parent.querySelector('[data-qa="vacancy-serp__vacancy_responded"]');
    if (respondedElement) {
        return true;
    }
    
    // 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—Å—Ç –≤—Å–µ–π –∫–∞—Ä—Ç–æ—á–∫–∏
    const parentText = parent.innerText || parent.textContent || '';
    if (parentText.includes('–í—ã –æ—Ç–∫–ª–∏–∫–Ω—É–ª–∏—Å—å') || 
        parentText.includes('–í—ã —É–∂–µ –æ—Ç–∫–ª–∏–∫–Ω—É–ª–∏—Å—å') ||
        parentText.includes('–û—Ç–∫–ª–∏–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω')) {
        return true;
    }
    
    // 3. –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–Ω–æ–ø–∫—É - –µ—Å–ª–∏ —Ç–µ–∫—Å—Ç –Ω–µ "–û—Ç–∫–ª–∏–∫–Ω—É—Ç—å—Å—è", –∑–Ω–∞—á–∏—Ç —É–∂–µ –æ—Ç–∫–ª–∏–∫–∞–ª–∏—Å—å
    const buttonText = button.innerText || button.textContent || '';
    if (!buttonText.includes('–û—Ç–∫–ª–∏–∫–Ω—É—Ç—å—Å—è') && buttonText.trim() !== '') {
        return true;
    }
    
    return false;
}

// =========== –ù–ê–ô–¢–ò –î–û–°–¢–£–ü–ù–´–ï –ö–ù–û–ü–ö–ò ===========
function getAvailableButtons() {
    // –ü–æ–ª—É—á–∞–µ–º –í–°–ï –∫–Ω–æ–ø–∫–∏ –æ—Ç–∫–ª–∏–∫–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
    const allButtons = Array.from(document.querySelectorAll('[data-qa="vacancy-serp__vacancy_response"]'));
    
    // –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –¥–æ—Å—Ç—É–ø–Ω—ã–µ
    const availableButtons = allButtons.filter(button => {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å
        if (button.offsetParent === null) return false;
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –æ—Ç–∫–ª–∏–∫–Ω—É–ª–∏—Å—å –ª–∏ —É–∂–µ
        return !isAlreadyRespondedVacancy(button);
    });
    
    return availableButtons;
}

// –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –∫–ª–∏–∫
async function safeClick(button, description) {
    console.log(`–ö–ª–∏–∫–∞–µ–º: ${description}`);
    
    // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º
    button.scrollIntoView({ behavior: 'smooth', block: 'center' });
    await wait(800);
    
    // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º
    const originalStyle = button.style.cssText;
    button.style.outline = '3px solid #FF9800';
    button.style.outlineOffset = '2px';
    button.style.transition = 'outline 0.3s';
    
    await wait(300);
    
    // –ú–µ—Ç–æ–¥ 1: –ü—Ä–æ—Å—Ç–æ–π click
    try {
        button.click();
        console.log('‚úì –ú–µ—Ç–æ–¥ 1: –æ–±—ã—á–Ω—ã–π click');
        await wait(300);
        return true;
    } catch (e) {
        console.log('‚úó –ú–µ—Ç–æ–¥ 1 –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª');
    }
    
    // –ú–µ—Ç–æ–¥ 2: –°–æ–∑–¥–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ –∫–ª–∏–∫–∞
    try {
        const rect = button.getBoundingClientRect();
        const x = rect.left + rect.width / 2;
        const y = rect.top + rect.height / 2;
        
        const mouseDown = new MouseEvent('mousedown', {
            view: window,
            bubbles: true,
            cancelable: true,
            clientX: x,
            clientY: y
        });
        
        const mouseUp = new MouseEvent('mouseup', {
            view: window,
            bubbles: true,
            cancelable: true,
            clientX: x,
            clientY: y
        });
        
        const clickEvent = new MouseEvent('click', {
            view: window,
            bubbles: true,
            cancelable: true,
            clientX: x,
            clientY: y
        });
        
        button.dispatchEvent(mouseDown);
        button.dispatchEvent(mouseUp);
        button.dispatchEvent(clickEvent);
        
        console.log('‚úì –ú–µ—Ç–æ–¥ 2: —Å–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è');
        await wait(300);
        return true;
    } catch (e) {
        console.log('‚úó –ú–µ—Ç–æ–¥ 2 –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª');
    }
    
    // –ú–µ—Ç–æ–¥ 3: –ò—Å–ø–æ–ª—å–∑—É–µ–º focus –∏ dispatchEvent
    try {
        button.focus();
        const event = new MouseEvent('click', {
            view: window,
            bubbles: true,
            cancelable: true
        });
        button.dispatchEvent(event);
        console.log('‚úì –ú–µ—Ç–æ–¥ 3: focus + dispatchEvent');
        await wait(300);
        return true;
    } catch (e) {
        console.log('‚úó –ú–µ—Ç–æ–¥ 3 –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª');
    }
    
    // –£–±–∏—Ä–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É
    setTimeout(() => {
        button.style.cssText = originalStyle;
    }, 1000);
    
    return false;
}

// –ñ–¥–∞—Ç—å –ø–æ—è–≤–ª–µ–Ω–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
async function waitForModal(timeout = 5000) {
    console.log('‚è≥ –û–∂–∏–¥–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ...');
    
    const startTime = Date.now();
    
    while (Date.now() - startTime < timeout) {
        // –ò—â–µ–º –ø–æ —Å–µ–ª–µ–∫—Ç–æ—Ä–∞–º
        const modalSelectors = [
            '[data-qa="vacancy-response-popup"]',
            '.vacancy-response-popup',
            '.bloko-modal-wrapper',
            '.bloko-modal',
            '.vacancy-serp-actions'
        ];
        
        for (const selector of modalSelectors) {
            const element = document.querySelector(selector);
            if (element && 
                element.offsetWidth > 0 && 
                element.offsetHeight > 0 &&
                window.getComputedStyle(element).display !== 'none') {
                console.log(`‚úÖ –ù–∞—à–ª–∏ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: ${selector}`);
                return element;
            }
        }
        
        // –ò—â–µ–º –ø–æ —Ç–µ–∫—Å—Ç—É
        const modalByText = document.querySelectorAll('*');
        for (const element of modalByText) {
            if (element.textContent && element.textContent.includes('–û—Ç–∫–ª–∏–∫ –Ω–∞ –≤–∞–∫–∞–Ω—Å–∏—é')) {
                console.log('‚úÖ –ù–∞—à–ª–∏ –º–æ–¥–∞–ª–∫—É –ø–æ —Ç–µ–∫—Å—Ç—É');
                return element.closest('.bloko-modal-wrapper') || element.closest('div[class*="modal"]') || element;
            }
        }
        
        await wait(300);
    }
    
    console.log('‚ùå –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–µ –ø–æ—è–≤–∏–ª–æ—Å—å');
    return null;
}

// –ù–ê–ô–¢–ò –ò –ù–ê–ñ–ê–¢–¨ –ö–ù–û–ü–ö–£ "–î–û–ë–ê–í–ò–¢–¨ –°–û–ü–†–û–í–û–î–ò–¢–ï–õ–¨–ù–û–ï"
async function clickAddCoverLetterButton() {
    console.log('üéØ –ò—â–µ–º –∫–Ω–æ–ø–∫—É "–î–æ–±–∞–≤–∏—Ç—å —Å–æ–ø—Ä–æ–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ–µ"...');
    
    // –í–∞—Ä–∏–∞–Ω—Ç 1: –ü–æ–∏—Å–∫ –ø–æ —Ç–æ—á–Ω—ã–º –∫–ª–∞—Å—Å–∞–º
    const buttonSelectors = [
        '.magritte-button-view___53Slm_7-0-6',
        'span.magritte-button-view___53Slm_7-0-6',
        '[class*="magritte-button-view"]',
        '[class*="magritte-button__label"]'
    ];
    
    for (const selector of buttonSelectors) {
        const elements = document.querySelectorAll(selector);
        console.log(`–ù–∞–π–¥–µ–Ω–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–º ${selector}: ${elements.length}`);
        
        for (const element of elements) {
            if (element.textContent && element.textContent.includes('–î–æ–±–∞–≤–∏—Ç—å —Å–æ–ø—Ä–æ–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ–µ')) {
                console.log(`‚úÖ –ù–∞—à–ª–∏ –ø–æ —Å–µ–ª–µ–∫—Ç–æ—Ä—É ${selector}`);
                
                // –ü—Ä–æ–±—É–µ–º –∫–ª–∏–∫–Ω—É—Ç—å
                for (let attempt = 1; attempt <= 3; attempt++) {
                    console.log(`\n--- –ü–æ–ø—ã—Ç–∫–∞ ${attempt} ---`);
                    
                    try {
                        element.click();
                        console.log('‚úì –ö–ª–∏–∫ —É—Å–ø–µ—à–µ–Ω');
                        await wait(1000);
                        return true;
                    } catch (e) {
                        console.log('‚úó –ù–µ —É–¥–∞–ª–æ—Å—å –∫–ª–∏–∫–Ω—É—Ç—å');
                    }
                    
                    // –ü—Ä–æ–±—É–µ–º –∫–ª–∏–∫–Ω—É—Ç—å –Ω–∞ —Ä–æ–¥–∏—Ç–µ–ª—è
                    try {
                        const parent = element.parentElement;
                        if (parent) {
                            parent.click();
                            console.log('‚úì –ö–ª–∏–∫ –ø–æ —Ä–æ–¥–∏—Ç–µ–ª—é —É—Å–ø–µ—à–µ–Ω');
                            await wait(1000);
                            return true;
                        }
                    } catch (e) {}
                    
                    await wait(300);
                }
            }
        }
    }
    
    // –í–∞—Ä–∏–∞–Ω—Ç 2: –ü–æ–∏—Å–∫ –ø–æ —Ç–µ–∫—Å—Ç—É
    console.log('\nüîç –ü–æ–∏—Å–∫ –ø–æ —Ç–æ—á–Ω–æ–º—É —Ç–µ–∫—Å—Ç—É...');
    const allElements = document.querySelectorAll('*');
    
    for (const element of allElements) {
        if (element.textContent && element.textContent.trim() === '–î–æ–±–∞–≤–∏—Ç—å —Å–æ–ø—Ä–æ–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ–µ') {
            console.log('‚úÖ –ù–∞—à–ª–∏ —ç–ª–µ–º–µ–Ω—Ç —Å —Ç–æ—á–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º');
            
            try {
                element.click();
                console.log('‚úì –ö–ª–∏–∫ —É—Å–ø–µ—à–µ–Ω');
                await wait(1000);
                return true;
            } catch (e) {
                console.log('‚úó –ù–µ —É–¥–∞–ª–æ—Å—å –∫–ª–∏–∫–Ω—É—Ç—å');
            }
        }
    }
    
    console.log('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏/–Ω–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É');
    return false;
}

// === –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –ú–ï–¢–û–î –î–õ–Ø REACT –ü–û–õ–ï–ô ===
async function fillCoverLetterField() {
    console.log('üîç –ò—â–µ–º –∏ –∑–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª–µ –¥–ª—è –ø–∏—Å—å–º–∞...');
    
    await wait(1500);
    
    // –ù–∞—Ö–æ–¥–∏–º –ø–æ–ª–µ
    const textarea = document.querySelector('[data-qa="vacancy-response-popup-form-letter-input"]');
    
    if (!textarea) {
        console.log('‚ùå –ü–æ–ª–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –ø–æ data-qa');
        return false;
    }
    
    console.log('‚úÖ –ù–∞—à–ª–∏ textarea');
    
    // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –ø–æ–ª—é
    textarea.scrollIntoView({ behavior: 'smooth', block: 'center' });
    await wait(500);
    
    // –ü–æ–¥—Å–≤–µ—Ç–∫–∞
    textarea.style.outline = '2px solid #4CAF50';
    textarea.style.outlineOffset = '2px';
    
    // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ
    textarea.focus();
    await wait(300);
    
    // –í—ã–¥–µ–ª—è–µ–º –≤–µ—Å—å —Ç–µ–∫—Å—Ç –µ—Å–ª–∏ –µ—Å—Ç—å
    textarea.select();
    await wait(200);
    
    // –°–ü–ï–¶–ò–ê–õ–¨–ù–´–ô –ú–ï–¢–û–î –î–õ–Ø REACT –ö–û–ú–ü–û–ù–ï–ù–¢–û–í
    console.log('–ó–∞–ø–æ–ª–Ω—è–µ–º React –ø–æ–ª–µ...');
    
    // –°–ø–æ—Å–æ–± 1: –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞—Ç–∏–≤–Ω—ã–π setter –∏ React —Å–æ–±—ã—Ç–∏—è
    try {
        // –ü–æ–ª—É—á–∞–µ–º –Ω–∞—Ç–∏–≤–Ω—ã–π setter –¥–ª—è value
        const nativeInputValueSetter = Object.getOwnPropertyDescriptor(
            window.HTMLTextAreaElement.prototype, 
            'value'
        ).set;
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –Ω–∞—Ç–∏–≤–Ω—ã–π setter
        nativeInputValueSetter.call(textarea, coverLetter);
        
        // –°–æ–∑–¥–∞–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ React-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ–µ —Å–æ–±—ã—Ç–∏–µ
        const reactInputEvent = new Event('input', { 
            bubbles: true,
            cancelable: true 
        });
        
        // –î–æ–±–∞–≤–ª—è–µ–º target –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
        Object.defineProperty(reactInputEvent, 'target', {
            value: textarea,
            enumerable: true
        });
        
        // –¢—Ä–∏–≥–≥–µ—Ä–∏–º —Å–æ–±—ã—Ç–∏–µ
        textarea.dispatchEvent(reactInputEvent);
        
        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
        const changeEvent = new Event('change', { bubbles: true });
        textarea.dispatchEvent(changeEvent);
        
        console.log('‚úì –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –Ω–∞—Ç–∏–≤–Ω—ã–π setter + React —Å–æ–±—ã—Ç–∏—è');
    } catch (e) {
        console.log('‚úó –°–ø–æ—Å–æ–± 1 –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª:', e);
        
        // –°–ø–æ—Å–æ–± 2: –ü–æ—Å–∏–º–≤–æ–ª—å–Ω—ã–π –≤–≤–æ–¥ —Å –ø–æ–ª–Ω–æ–π —Å–∏–º—É–ª—è—Ü–∏–µ–π
        try {
            console.log('–ü—Ä–æ–±—É–µ–º –ø–æ—Å–∏–º–≤–æ–ª—å–Ω—ã–π –≤–≤–æ–¥...');
            
            // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ
            textarea.focus();
            textarea.select();
            document.execCommand('delete');
            await wait(100);
            
            // –í–≤–æ–¥–∏–º –∫–∞–∂–¥—ã–π —Å–∏–º–≤–æ–ª
            for (let i = 0; i < coverLetter.length; i++) {
                const char = coverLetter[i];
                
                // –°–æ–±—ã—Ç–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–∏–º–≤–æ–ª–∞
                const keydownEvent = new KeyboardEvent('keydown', {
                    key: char,
                    code: 'Key' + char.toUpperCase(),
                    charCode: char.charCodeAt(0),
                    keyCode: char.charCodeAt(0),
                    which: char.charCodeAt(0),
                    bubbles: true
                });
                
                const keypressEvent = new KeyboardEvent('keypress', {
                    key: char,
                    charCode: char.charCodeAt(0),
                    keyCode: char.charCodeAt(0),
                    bubbles: true
                });
                
                const inputEvent = new Event('input', { bubbles: true });
                
                textarea.dispatchEvent(keydownEvent);
                textarea.dispatchEvent(keypressEvent);
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Å–∏–º–≤–æ–ª –∫ —Ç–µ–∫—É—â–µ–º—É –∑–Ω–∞—á–µ–Ω–∏—é
                textarea.value += char;
                textarea.dispatchEvent(inputEvent);
                
                // –ü–∞—É–∑–∞ –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ç–µ–∫—Å—Ç–æ–≤
                if (i % 50 === 0) {
                    await wait(10);
                }
            }
            
            // –§–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ change
            const finalChangeEvent = new Event('change', { bubbles: true });
            textarea.dispatchEvent(finalChangeEvent);
            
            console.log('‚úì –ü–æ—Å–∏–º–≤–æ–ª—å–Ω—ã–π –≤–≤–æ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω');
        } catch (e2) {
            console.log('‚úó –°–ø–æ—Å–æ–± 2 –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª:', e2);
            
            // –°–ø–æ—Å–æ–± 3: –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ React state
            try {
                console.log('–ü—Ä–æ–±—É–µ–º –ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ React...');
                
                // –ò—â–µ–º React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
                let reactInstance = null;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ React –≤–Ω—É—Ç—Ä–µ–Ω–Ω–æ—Å—Ç–µ–π
                if (textarea.__reactFiber$) {
                    reactInstance = textarea.__reactFiber$;
                } else if (textarea.__reactInternalInstance$) {
                    reactInstance = textarea.__reactInternalInstance$;
                } else {
                    // –ò—â–µ–º React —á–µ—Ä–µ–∑ —Å–æ–±—ã—Ç–∏—è
                    for (const key in textarea) {
                        if (key.includes('react') || key.includes('__react')) {
                            reactInstance = textarea[key];
                            break;
                        }
                    }
                }
                
                if (reactInstance) {
                    console.log('–ù–∞—à–ª–∏ React –∏–Ω—Å—Ç–∞–Ω—Å');
                    
                    // –ü—Ä–æ–±—É–µ–º –æ–±–Ω–æ–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                    textarea.value = coverLetter;
                    
                    // –°–∏–º—É–ª–∏—Ä—É–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
                    const events = ['input', 'change', 'blur', 'focus'];
                    events.forEach(eventType => {
                        const event = new Event(eventType, { bubbles: true });
                        Object.defineProperty(event, 'target', { value: textarea });
                        textarea.dispatchEvent(event);
                    });
                    
                    console.log('‚úì –û–±–Ω–æ–≤–∏–ª–∏ —á–µ—Ä–µ–∑ React');
                }
            } catch (e3) {
                console.log('‚úó –°–ø–æ—Å–æ–± 3 –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª:', e3);
            }
        }
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    await wait(500);
    console.log('–¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ª—è:', textarea.value ? `[${textarea.value.length} —Å–∏–º–≤–æ–ª–æ–≤]` : '–ø—É—Å—Ç–æ–µ');
    
    // –ï—Å–ª–∏ –ø–æ–ª–µ –≤—Å–µ –µ—â–µ –ø—É—Å—Ç–æ–µ, –ø—Ä–æ–±—É–µ–º —Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–±
    if (!textarea.value || textarea.value.length < 10) {
        console.log('–ü–æ–ª–µ –ø—É—Å—Ç–æ–µ, –ø—Ä–æ–±—É–µ–º —Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–±...');
        
        // –ü–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–∞–µ–º
        textarea.value = '';
        await wait(100);
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ
        textarea.value = coverLetter;
        
        // –°–æ–∑–¥–∞–µ–º –∏ —Ç—Ä–∏–≥–≥–µ—Ä–∏–º input —Å–æ–±—ã—Ç–∏–µ
        const event = new Event('input', { bubbles: true });
        textarea.dispatchEvent(event);
        
        // –¢–∞–∫–∂–µ —Ç—Ä–∏–≥–≥–µ—Ä–∏–º change
        const changeEvent = new Event('change', { bubbles: true });
        textarea.dispatchEvent(changeEvent);
        
        await wait(300);
    }
    
    // –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
    if (textarea.value && textarea.value.length > 10) {
        console.log('‚úÖ –ü–æ–ª–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ!');
        
        // –£–±–∏—Ä–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É
        setTimeout(() => {
            textarea.style.outline = '';
        }, 1000);
        
        return true;
    } else {
        console.log('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø–æ–ª–Ω–∏—Ç—å –ø–æ–ª–µ');
        return false;
    }
}

// –ù–ê–ô–¢–ò –ò –ù–ê–ñ–ê–¢–¨ –ö–ù–û–ü–ö–£ –û–¢–ü–†–ê–í–ö–ò
async function clickSubmitButton() {
    console.log('üîç –ò—â–µ–º –∫–Ω–æ–ø–∫—É –æ—Ç–ø—Ä–∞–≤–∫–∏...');
    
    // –ò—â–µ–º –ø–æ data-qa –∞—Ç—Ä–∏–±—É—Ç—É
    const submitSelectors = [
        '[data-qa="vacancy-response-submit-popup"]',
        'button[type="submit"]',
        '.vacancy-response-popup__submit'
    ];
    
    for (const selector of submitSelectors) {
        const button = document.querySelector(selector);
        if (button) {
            console.log(`‚úÖ –ù–∞—à–ª–∏ –∫–Ω–æ–ø–∫—É –æ—Ç–ø—Ä–∞–≤–∫–∏: ${selector}`);
            
            try {
                button.click();
                console.log('‚úÖ –ö–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞–∂–∞—Ç–∞');
                return true;
            } catch (e) {
                console.log('‚úó –û—à–∏–±–∫–∞:', e);
            }
        }
    }
    
    // –ò—â–µ–º –ø–æ —Ç–µ–∫—Å—Ç—É
    const textButtons = ['–û—Ç–∫–ª–∏–∫–Ω—É—Ç—å—Å—è', '–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–∫–ª–∏–∫'];
    const allButtons = document.querySelectorAll('button');
    
    for (const button of allButtons) {
        for (const text of textButtons) {
            if (button.textContent && button.textContent.includes(text)) {
                console.log(`‚úÖ –ù–∞—à–ª–∏ –∫–Ω–æ–ø–∫—É –ø–æ —Ç–µ–∫—Å—Ç—É: ${button.textContent}`);
                
                try {
                    button.click();
                    console.log('‚úÖ –ö–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞–∂–∞—Ç–∞');
                    return true;
                } catch (e) {
                    console.log('‚úó –û—à–∏–±–∫–∞:', e);
                }
            }
        }
    }
    
    console.log('‚ùå –ö–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
    return false;
}

// –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
async function processModalWindow() {
    // –ñ–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è –º–æ–¥–∞–ª–∫–∏
    const modal = await waitForModal(6000);
    
    if (!modal) {
        return false;
    }
    
    try {
        // –ñ–¥–µ–º –Ω–µ–º–Ω–æ–≥–æ —á—Ç–æ–±—ã –≤—Å–µ –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å
        await wait(1000);
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –ø–µ—Ä–µ–µ–∑–¥–µ
        const warningBtn = modal.querySelector('[data-qa="relocation-warning-confirm"]');
        if (warningBtn) {
            console.log('–ù–∞–∂–∏–º–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–µ—Ä–µ–µ–∑–¥–∞');
            warningBtn.click();
            await wait(1000);
        }
        
        // –®–ê–ì 1: –ù–∞–∂–∏–º–∞–µ–º –Ω–∞ –∫–Ω–æ–ø–∫—É "–î–æ–±–∞–≤–∏—Ç—å —Å–æ–ø—Ä–æ–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ–µ"
        updateStatus('üìù –ù–∞–∂–∏–º–∞–µ–º "–î–æ–±–∞–≤–∏—Ç—å —Å–æ–ø—Ä–æ–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ–µ"...');
        const letterButtonClicked = await clickAddCoverLetterButton();
        
        // –®–ê–ì 2: –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª–µ –ø–∏—Å—å–º–∞
        let letterFilled = false;
        if (letterButtonClicked) {
            updateStatus('‚úçÔ∏è –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–∏—Å—å–º–æ...');
            letterFilled = await fillCoverLetterField();
        }
        
        // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ –∫–Ω–æ–ø–∫—É, –≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–ª–µ —É–∂–µ –æ—Ç–∫—Ä—ã—Ç–æ
        if (!letterButtonClicked) {
            console.log('–ü—Ä–æ–±—É–µ–º –∑–∞–ø–æ–ª–Ω–∏—Ç—å –ø–æ–ª–µ –±–µ–∑ –∫–Ω–æ–ø–∫–∏...');
            updateStatus('‚úçÔ∏è –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–∏—Å—å–º–æ (–ø–æ–ª–µ —É–∂–µ –æ—Ç–∫—Ä—ã—Ç–æ)...');
            letterFilled = await fillCoverLetterField();
        }
        
        // –®–ê–ì 3: –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–∫–ª–∏–∫
        updateStatus('üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–∫–ª–∏–∫...');
        const submitted = await clickSubmitButton();
        
        if (submitted) {
            // –ñ–¥–µ–º –æ—Ç–ø—Ä–∞–≤–∫–∏
            await wait(2000);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ø–µ—à–Ω–æ—Å—Ç—å
            const successIndicators = ['–û—Ç–∫–ª–∏–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω', 'Response sent'];
            let successFound = false;
            
            const allElements = document.querySelectorAll('*');
            for (const element of allElements) {
                if (element.textContent) {
                    for (const indicator of successIndicators) {
                        if (element.textContent.includes(indicator)) {
                            successFound = true;
                            break;
                        }
                    }
                }
                if (successFound) break;
            }
            
            if (successFound) {
                console.log('‚úÖ –û—Ç–∫–ª–∏–∫ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!');
                updateStatus('‚úÖ –û—Ç–∫–ª–∏–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!');
                return true;
            } else {
                console.log('‚úÖ –û—Ç–∫–ª–∏–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω (–ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ)');
                updateStatus('‚úÖ –û—Ç–∫–ª–∏–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω');
                return true;
            }
        }
        
    } catch (error) {
        console.log('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –º–æ–¥–∞–ª–∫–∏:', error);
        updateStatus('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ');
    }
    
    return false;
}

// –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ–¥–Ω—É –≤–∞–∫–∞–Ω—Å–∏—é
async function processSingleVacancy(button, index, total) {
    if (!isRunning) return false;
    
    stats.total++;
    
    const vacancyId = getVacancyId(button);
    
    // –£–∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏ —ç—Ç—É –≤–∞–∫–∞–Ω—Å–∏—é?
    if (processedVacancies.has(vacancyId)) {
        stats.skipped++;
        updateStats();
        updateStatus(`‚è≠Ô∏è ${index + 1}/${total}: —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞`);
        return false;
    }
    
    // –£–∂–µ –æ—Ç–∫–ª–∏–∫–∞–ª–∏—Å—å –Ω–∞ —ç—Ç—É –≤–∞–∫–∞–Ω—Å–∏—é?
    if (isAlreadyRespondedVacancy(button)) {
        processedVacancies.add(vacancyId);
        stats.skipped++;
        updateStats();
        updateStatus(`‚è≠Ô∏è ${index + 1}/${total}: —É–∂–µ –æ—Ç–∫–ª–∏–∫–∞–ª–∏—Å—å`);
        return false;
    }
    
    updateStatus(`üéØ ${index + 1}/${total}: –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º...`);
    
    // –ù–∞–∂–∏–º–∞–µ–º –∫–Ω–æ–ø–∫—É –æ—Ç–∫–ª–∏–∫–∞
    const clicked = await safeClick(button, `–û—Ç–∫–ª–∏–∫ ${index + 1}`);
    
    if (!clicked) {
        processedVacancies.add(vacancyId);
        stats.failed++;
        updateStats();
        updateStatus(`‚ùå ${index + 1}/${total}: –Ω–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–∂–∞—Ç—å`);
        return false;
    }
    
    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
    const success = await processModalWindow();
    
    if (success) {
        processedVacancies.add(vacancyId);
        stats.success++;
        updateStats();
        updateStatus(`‚úÖ ${index + 1}/${total}: –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!`);
        return true;
    } else {
        processedVacancies.add(vacancyId);
        stats.failed++;
        updateStats();
        updateStatus(`‚ö†Ô∏è ${index + 1}/${total}: –Ω–µ —É–¥–∞–ª–æ—Å—å`);
        return false;
    }
}

// –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
async function testProcess() {
    if (isRunning) return;
    
    coverLetter = document.getElementById('hh-letter').value;
    updateStatus('üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º...');
    
    const buttons = getAvailableButtons();
    if (buttons.length === 0) {
        updateStatus('‚ùå –ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤–∞–∫–∞–Ω—Å–∏–π –¥–ª—è —Ç–µ—Å—Ç–∞');
        return;
    }
    
    updateStatus('–¢–µ—Å—Ç: –Ω–∞–∂–∏–º–∞–µ–º –Ω–∞ –ø–µ—Ä–≤—É—é –≤–∞–∫–∞–Ω—Å–∏—é...');
    
    isRunning = true;
    const success = await processSingleVacancy(buttons[0], 0, 1);
    isRunning = false;
    
    if (success) {
        updateStatus('‚úÖ –¢–µ—Å—Ç —É—Å–ø–µ—à–µ–Ω! –ú–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –∞–≤—Ç–æ-–æ—Ç–∫–ª–∏–∫.');
    } else {
        updateStatus('‚ö†Ô∏è –¢–µ—Å—Ç –Ω–µ —É–¥–∞–ª—Å—è. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å (F12).');
    }
}

// –û—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ—Ü–µ—Å—Å
async function startProcess() {
    if (isRunning) return;
    
    coverLetter = document.getElementById('hh-letter').value;
    isRunning = true;
    
    // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫–∏
    document.getElementById('hh-start').style.display = 'none';
    document.getElementById('hh-test').style.display = 'none';
    document.getElementById('hh-stop').style.display = 'block';
    
    updateStatus('üöÄ –ó–∞–ø—É—Å–∫ –∞–≤—Ç–æ-–æ—Ç–∫–ª–∏–∫–∞...');
    
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Å–µ—Å—Å–∏–∏
    stats = { success: 0, failed: 0, skipped: 0, total: 0 };
    updateStats();
    
    while (isRunning) {
        const buttons = getAvailableButtons();
        updateCounter();
        
        if (buttons.length === 0) {
            updateStatus('‚úÖ –í—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –≤–∞–∫–∞–Ω—Å–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
            const nextBtn = document.querySelector('[data-qa="pager-next"]:not([disabled])');
            if (nextBtn && isRunning) {
                updateStatus('‚û°Ô∏è –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É...');
                await wait(2000);
                nextBtn.click();
                await wait(4000);
                continue;
            } else {
                updateStatus(`üéâ –ó–∞–≤–µ—Ä—à–µ–Ω–æ! –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
‚úÖ –£—Å–ø–µ—à–Ω–æ: ${stats.success}
‚ùå –ù–µ—É–¥–∞—á–Ω–æ: ${stats.failed}
‚è≠Ô∏è –ü—Ä–æ–ø—É—â–µ–Ω–æ: ${stats.skipped}`);
                break;
            }
        }
        
        updateStatus(`üìä –û–±—Ä–∞–±–æ—Ç–∫–∞ ${buttons.length} –≤–∞–∫–∞–Ω—Å–∏–π...`);
        
        for (let i = 0; i < buttons.length; i++) {
            if (!isRunning) break;
            
            await processSingleVacancy(buttons[i], i, buttons.length);
            
            // –ü–∞—É–∑–∞ –º–µ–∂–¥—É –æ—Ç–∫–ª–∏–∫–∞–º–∏
            if (i < buttons.length - 1 && isRunning) {
                updateStatus(`‚è≥ –ü–∞—É–∑–∞ 2 —Å–µ–∫—É–Ω–¥—ã...`);
                await wait(2000);
            }
        }
        
        // –ö–æ—Ä–æ—Ç–∫–∞—è –ø–∞—É–∑–∞ –ø–µ—Ä–µ–¥ —Å–ª–µ–¥—É—é—â–µ–π –ø—Ä–æ–≤–µ—Ä–∫–æ–π
        if (isRunning) {
            await wait(1000);
        }
    }
    
    stopProcess();
}

// –û—Å—Ç–∞–Ω–æ–≤–∫–∞
function stopProcess() {
    isRunning = false;
    
    document.getElementById('hh-start').style.display = 'block';
    document.getElementById('hh-test').style.display = 'block';
    document.getElementById('hh-stop').style.display = 'none';
    
    updateStatus('‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
}

// –ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞
(function init() {
    console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–≤—Ç–æ-–æ—Ç–∫–ª–∏–∫–∞ v5.6 Stable+...');
    console.log('üîß –†–∞–±–æ—á–∞—è –≤–µ—Ä—Å–∏—è —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –æ—Ç–∫–ª–∏–∫–æ–≤');
    
    createPanel();
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã
    setInterval(updateCounter, 3000);
    
    setTimeout(() => {
        const buttons = getAvailableButtons();
        updateCounter();
        updateStatus(`‚úÖ –ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ\nüìä –î–æ—Å—Ç—É–ø–Ω–æ –≤–∞–∫–∞–Ω—Å–∏–π: ${buttons.length}\nüìù –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∏—Å—å–º–æ –∏ –Ω–∞–∂–º–∏—Ç–µ "–¢–µ—Å—Ç"`);
    }, 2000);
})();
